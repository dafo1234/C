import streamlit as st
import datetime
import pandas as pd
import os

st.title("ğŸ“… Calculateur de cycle menstruel")

# EntrÃ©es utilisateur
last_period = st.date_input("Date du premier jour des derniÃ¨res rÃ¨gles")
cycle_length = st.number_input("DurÃ©e moyenne du cycle (jours)", min_value=20, max_value=40, value=28)
period_length = st.number_input("DurÃ©e moyenne des rÃ¨gles (jours)", min_value=3, max_value=10, value=5)

# Calcul des dates clÃ©s
next_period = last_period + datetime.timedelta(days=cycle_length)
ovulation_day = last_period + datetime.timedelta(days=cycle_length - 14)

st.subheader("RÃ©sultats estimÃ©s")
st.write(f"ğŸ“ Prochain cycle : {next_period.strftime('%d %B %Y')}")
st.write(f"ğŸŒ¸ Ovulation probable : {ovulation_day.strftime('%d %B %Y')}ğŸŒ¸")

# Sauvegarde dans un CSV
if st.button("ğŸ’¾ Sauvegarder ce cycle"):
    data = {
        "Date derniÃ¨res rÃ¨gles": [last_period],
        "DurÃ©e cycle (jours)": [cycle_length],
        "DurÃ©e rÃ¨gles (jours)": [period_length],
        "Prochain cycle": [next_period],
        "Ovulation probable": [ovulation_day]
    }
    df = pd.DataFrame(data)

    # Si le fichier existe dÃ©jÃ , on ajoute les nouvelles donnÃ©es
    if os.path.exists("cycles.csv"):
        df.to_csv("cycles.csv", mode="a", header=False, index=False)
    else:
        df.to_csv("cycles.csv", index=False)

    st.success("Cycle sauvegardÃ© avec succÃ¨s ğŸ‰")

# Afficher lâ€™historique
if os.path.exists("cycles.csv"):
    st.subheader("ğŸ“– Historique des cycles")
    history = pd.read_csv("cycles.csv")
    st.dataframe(history)
